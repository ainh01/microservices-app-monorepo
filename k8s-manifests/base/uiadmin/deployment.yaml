apiVersion: apps/v1  
kind: Deployment  
metadata:  
  name: uiadmin  
  namespace: microservices-app  
  labels:  
    app: uiadmin  
    tier: frontend  
    version: v1  
spec:  
  replicas: 1  # As specified  
  
  selector:  
    matchLabels:  
      app: uiadmin  
  
  strategy:  
    type: RollingUpdate  
    rollingUpdate:  
      maxSurge: 1  
      maxUnavailable: 0  # Ensure availability during updates  
  
  template:  
    metadata:  
      labels:  
        app: uiadmin  
        tier: frontend  
        version: v1  
    
    spec:  
      imagePullSecrets:  
        - name: acr-secret  # Remove if using managed identity  
      
      securityContext:  
        runAsNonRoot: true  
        runAsUser: 1000  
        fsGroup: 1000  
      
      containers:  
      - name: uiadmin  
        image: webtruyenacr17501.azurecr.io/uiadmin:latest  
        imagePullPolicy: Always  
        
        ports:  
        - name: http  
          containerPort: 3000  
          protocol: TCP  
        
        env:  
        - name: NODE_ENV  
          value: "production"  
        - name: API_BACKEND_URL  
          value: "http://apidatatruyen.microservices-app.svc.cluster.local:8000"  
        
        resources:  
          requests:  
            memory: "256Mi"  
            cpu: "200m"  
          limits:  
            memory: "512Mi"  
            cpu: "400m"  
        
        livenessProbe:  
          httpGet:  
            path: /health  
            port: http  
          initialDelaySeconds: 30  
          periodSeconds: 10  
          timeoutSeconds: 5  
          failureThreshold: 3  
        
        readinessProbe:  
          httpGet:  
            path: /health  
            port: http  
          initialDelaySeconds: 10  
          periodSeconds: 5  
          timeoutSeconds: 3  
          failureThreshold: 3  
        
        securityContext:  
          allowPrivilegeEscalation: false  
          capabilities:  
            drop:  
            - ALL  
      
      terminationGracePeriodSeconds: 30  
