apiVersion: v1  
kind: Service  
metadata:  
  name: apiotruyen  
  namespace: microservices-app  
  labels:  
    app: apiotruyen  
    tier: backend  
  annotations:  
    # Azure-specific annotations  
    service.beta.kubernetes.io/azure-load-balancer-internal: "false"  # Public LB  
spec:  
  type: ClusterIP  
  
  # Session affinity (optional, for sticky sessions)  
  sessionAffinity: None  
  
  # Selector matches Deployment pod labels  
  selector:  
    app: apiotruyen  
  
  # Ports configuration  
  ports:  
  - name: http  
    protocol: TCP  
    port: 8001        # External port on LoadBalancer  
    targetPort: http  # Maps to container port named 'http'  
  
  # Source IP preservation  
  externalTrafficPolicy: Cluster  # Or 'Local' for source IP preservation  
